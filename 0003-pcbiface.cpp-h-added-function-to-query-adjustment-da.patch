From 0a420559841d25ac7f6dd58310e1b97b24c91bb5 Mon Sep 17 00:00:00 2001
From: Peter Lohmer <peterlohmer01@gmail.com>
Date: Thu, 15 Nov 2018 14:55:52 +0100
Subject: [PATCH 3/7] pcbiface.cpp,h: added function to query adjustment data
 version

Signed-off-by: Peter Lohmer <peterlohmer01@gmail.com>
---
 pcbiface.cpp |   23 +++++++++++++++++++++--
 pcbiface.h   |    5 +++++
 2 Dateien geändert, 26 Zeilen hinzugefügt(+), 2 Zeilen entfernt(-)

diff --git a/pcbiface.cpp b/pcbiface.cpp
index 5e78174..cd2abb9 100644
--- a/pcbiface.cpp
+++ b/pcbiface.cpp
@@ -76,6 +76,7 @@ void cPCBIFace::ActionHandler(int entryAHS)
     case PCBReadDeviceVersionFinished:
     case PCBReadServerVersionFinished:
     case PCBReadSerialNrFinished:
+    case PCBReadJustdataVersionFinished:
     case GetAdjStatusFinished:
     case SetSenseProtectionFinished:	
         if (m_biFaceError)
@@ -195,6 +196,11 @@ void cPCBIFace::ActionHandler(int entryAHS)
         AHS++;
         break;
 	
+    case PCBReadJustdataVersionStart:
+        SendReadJustdataVersionCommand();
+        AHS++;
+        break;
+
     case GetAdjStatusStart:
         SendGetAdjStatusCommand();
         AHS++;
@@ -393,7 +399,13 @@ void cPCBIFace::ReadServerVersion()
 
 void cPCBIFace::ReadSerialNr()
 {
-    m_ActTimer->start(0,PCBReadSerialNrStart);   
+    m_ActTimer->start(0,PCBReadSerialNrStart);
+}
+
+
+void cPCBIFace::ReadJustDataVersion()
+{
+    m_ActTimer->start(0,PCBReadJustdataVersionStart);
 }
 
 
@@ -541,7 +553,14 @@ void cPCBIFace::SendReadServerVersionCommand()
 void cPCBIFace::SendReadSerialNrCommand()
 {
     QString cmds = QString("syst:sern?\n");
-    iFaceSock->SendQuery(cmds);    
+    iFaceSock->SendQuery(cmds);
+}
+
+
+void cPCBIFace::SendReadJustdataVersionCommand()
+{
+    QString cmds = QString("syst:vers:adj?\n");
+    iFaceSock->SendQuery(cmds);
 }
 
 
diff --git a/pcbiface.h b/pcbiface.h
index c09b942..3e18389 100644
--- a/pcbiface.h
+++ b/pcbiface.h
@@ -84,6 +84,9 @@ enum pcbIFaceActionHandlerState {
     
     PCBReadSerialNrStart,
     PCBReadSerialNrFinished,
+
+    PCBReadJustdataVersionStart,
+    PCBReadJustdataVersionFinished,
     
     GetAdjStatusStart,
     GetAdjStatusFinished,
@@ -129,6 +132,7 @@ public:
     void ReadDeviceVersion();
     void ReadServerVersion();
     void ReadSerialNr();
+    void ReadJustDataVersion();
     
 protected slots:
     void ActionHandler(int);
@@ -163,6 +167,7 @@ private:
     void SendReadDeviceVersionCommand();
     void SendReadServerVersionCommand();
     void SendReadSerialNrCommand();
+    void SendReadJustdataVersionCommand();
     void SendReadFlashChksumCommand();
     void SendGetAdjStatusCommand();
     
-- 
1.7.10.4

